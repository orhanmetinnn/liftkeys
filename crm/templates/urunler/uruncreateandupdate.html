{% extends "crmtemplates/base.html" %}
{% block content %}
{% load static %}
{% load i18n %}
    
    <div class="container py-5">
        <div class="glass-card mx-auto col-lg-12" data-aos="fade-up">
            <div class="btn-group mb-4" role="group" aria-label="Form toggle">
                <button type="button" id="btn-create" class="btn btn-primary active" onclick="showForm('create')">Yeni Kayıt</button>
                <button type="button" id="btn-update" class="btn btn-outline-primary" onclick="showForm('update')">Eklenen Listesi</button>
            </div>

            <div class="btn-group mb-4" role="group" aria-label="Form toggle">
                <button class="btn btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#createCountryCollapse" aria-expanded="false" aria-controls="createCountryCollapse">
                    Katagori Oluştur
                </button>
                <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#updateCountryCollapse" aria-expanded="false" aria-controls="updateCountryCollapse">
                    Katagori Güncelle
                </button>
            </div>

            <div class="collapse" id="createCountryCollapse">
                <div class="card  card-body mb-3">
                    <form method="POST" action="" novalidate>
                    {% csrf_token %}
                    <h5>Yeni Katagori Oluştur</h5>
                    <div class="mb-3">
                        {{ formcreatecatagory.name.label_tag }}
                        {{ formcreatecatagory.name }}
                    </div>

                    <button type="submit" name="create_catagory_submit" class="btn btn-danger">Kaydet</button>
                    <button type="button" class="btn btn-secondary" data-bs-toggle="collapse" data-bs-target="#createCountryCollapse">İptal</button>
                    </form>
                </div>
            </div>

            <div class="collapse" id="updateCountryCollapse">
                <div class="card card-body mb-3">
                    <div class="mb-3">
                    <label for="catagorySelect" class="form-label">Ülke Seçiniz</label>
                    <select id="catagorySelect" class="form-select" onchange="toggleCountryForm(this.value)">
                        <option value="" selected>Seçiniz</option>
                        {% for catagory in catagory_list %}
                            <option value="{{ catagory.id }}">{{ catagory.name }}</option>
                        {% endfor %}
                    </select>
                    </div>
                    <form method="POST" action="" id="formcatogryupdate" novalidate>
                        {% csrf_token %}
                        <input type="hidden"  id="update_catagory_id" name="update_catagory_id" value="">
                        <h5>Ülke Güncelle</h5>
                        <div class="mb-3">
                            {{ formcatogryupdate.name.label_tag }}
                            {{ formcatogryupdate.name }}
                        </div>

                        <button type="submit" name="update_catagory_submit" class="btn btn-info">Güncelle</button>
                        <button type="button" class="btn btn-secondary" data-bs-toggle="collapse" data-bs-target="#updateCountryCollapse">İptal</button>
                    </form>
                </div>
            </div>





            <div class="container mt-4">
                <h2>{{ action }}</h2>
                <form method="post" enctype="multipart/form-data" novalidate>
                    {% csrf_token %}
                    <div class="mb-3">
                        {{ form.name.label_tag }} 
                        {{ form.name }}
                        {% if form.name.errors %}
                            <div class="text-danger">{{ form.name.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        {{ form.website_image.label_tag }} 
                        {{ form.website_image }}
                        {% if form.website_image.errors %}
                            <div class="text-danger">{{ form.website_image.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        {{ form.mobile_image.label_tag }} 
                        {{ form.mobile_image }}
                        {% if form.mobile_image.errors %}
                            <div class="text-danger">{{ form.mobile_image.errors }}</div>
                        {% endif %}
                    </div>


                    <div class="mb-3">
                        {{ form.features.label_tag }} 
                        {{ form.features }}
                        {% if form.features.errors %}
                            <div class="text-danger">{{ form.features.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        {{ form.stock_code.label_tag }} 
                        {{ form.stock_code }}
                        {% if form.stock_code.errors %}
                            <div class="text-danger">{{ form.stock_code.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        {{ form.categories.label_tag }} 
                        {{ form.categories }}
                        {% if form.categories.errors %}
                            <div class="text-danger">{{ form.categories.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        {{ form.description.label_tag }} 
                        {{ form.description }}
                        {% if form.description.errors %}
                            <div class="text-danger">{{ form.description.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        {{ form.price.label_tag }} 
                        {{ form.price }}
                        {% if form.price.errors %}
                            <div class="text-danger">{{ form.price.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="form-check mb-3">
                        {{ form.is_active }} 
                        {{ form.is_active.label_tag }}
                        {% if form.is_active.errors %}
                            <div class="text-danger">{{ form.is_active.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        {{ form.weight.label_tag }} 
                        {{ form.weight }}
                        {% if form.weight.errors %}
                            <div class="text-danger">{{ form.weight.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        {{ form.dimensions.label_tag }} 
                        {{ form.dimensions }}
                        {% if form.dimensions.errors %}
                            <div class="text-danger">{{ form.dimensions.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        {{ form.color.label_tag }} 
                        {{ form.color }}
                        {% if form.color.errors %}
                            <div class="text-danger">{{ form.color.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        {{ form.warranty_period.label_tag }} 
                        {{ form.warranty_period }}
                        {% if form.warranty_period.errors %}
                            <div class="text-danger">{{ form.warranty_period.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        {{ form.video_url.label_tag }} 
                        {{ form.video_url }}
                        {% if form.video_url.errors %}
                            <div class="text-danger">{{ form.video_url.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        {{ form.related_products.label_tag }} 
                        {{ form.related_products }}
                        {% if form.related_products.errors %}
                            <div class="text-danger">{{ form.related_products.errors }}</div>
                        {% endif %}
                    </div>

                    <button type="submit" class="btn btn-primary">{{ action }}</button>
                    <a href="{% url 'product_list' %}" class="btn btn-secondary ms-2">İptal</a>
                </form>
            </div>
            </div>
            
        </div>


    </div>

    


    {% if messages %}
    <div id="message-container" style="position: fixed; top: 20px; right: 20px; z-index: 9999;">
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    </div>
    {% endif %}




    <script>
        function showForm(type) {
            const createForm = document.getElementById('form-create');
            const updateForm = document.getElementById('form-update');
            const btnCreate = document.getElementById('btn-create');
            const btnUpdate = document.getElementById('btn-update');

            if(type === 'create'){
                createForm.style.display = 'block';
                updateForm.style.display = 'none';
                btnCreate.classList.add('btn-primary', 'active');
                btnCreate.classList.remove('btn-outline-primary');
                btnUpdate.classList.remove('btn-primary', 'active');
                btnUpdate.classList.add('btn-outline-primary');
            } else {
                createForm.style.display = 'none';
                updateForm.style.display = 'block';
                btnCreate.classList.remove('btn-primary', 'active');
                btnCreate.classList.add('btn-outline-primary');
                btnUpdate.classList.add('btn-primary', 'active');
                btnUpdate.classList.remove('btn-outline-primary');
            }
        }

    </script>

    
    <script>
        function toggleCountryForm(categoryId) {
            if (!categoryId) {
                document.getElementById('formcatogryupdate').reset();
                document.getElementById('update_catagory_id').value = '';
                return;
            }

            fetch(`/catogory_detail_api/${categoryId}/`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('update_catagory_id').value = data.id;
                    document.getElementById('id_update-name').value = data.name || '';
                    console.log(`Loaded data for category ID ${categoryId}:`, data);
                })
                .catch(error => {
                    console.error('Kategori verisi alınırken hata:', error);
                });
        }
    </script>

    <!-- AOS -->
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <script>
        AOS.init();
    </script>
{% endblock %}


